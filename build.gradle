apply plugin: 'java'
apply plugin: 'war'

loadConfigFile();

task "create-dirs" << {
	webAppDir.mkdirs();
	sourceSets*.java.srcDirs*.each { it.mkdirs() }    
	sourceSets*.resources.srcDirs*.each{ it.mkdirs() }
}

task "create-package"(dependsOn: 'create-dirs') << {
	def dirlist = sourceSets*.java.srcDirs*.grep({ it.parentFile.name == 'main' } )
	def mainJavaDir = dirlist.flatten()
        def packageFolder=config.project.packageName.replaceAll('\\.',File.separator) 
	new File(mainJavaDir[0],packageFolder).mkdirs()
}

task cg(dependsOn: 'create-package')  << {
//	println "package:$config"
	println "package:$config.project.packageName"

}

def loadConfigFile() {
	def softwareStack = hasProperty('env') ? env : 'spring_RESTful'
	setProperty 'softwareStack', softwareStack
	println "Software Stack is set to $softwareStack"
	def configFile = file('config.groovy')
	def config = new ConfigSlurper(softwareStack).parse(configFile.toURL())
	setProperty 'config', config
}
